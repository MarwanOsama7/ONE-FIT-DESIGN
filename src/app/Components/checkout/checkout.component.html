<app-navbar-checkout></app-navbar-checkout>
<div class="container">
    <div class="row" style="margin-top: 20px;">
        <div class="col-xl-8">
            <div class="card">
                <div class="card-body">
                    <ol class="activity-checkout mb-0 px-4 mt-3">
                        <li class="checkout-item">
                            <div class="avatar checkout-icon p-1">
                                <div class="avatar-title rounded-circle bg-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="white">
                                        <path
                                            d="M3 21v-18c0-.553.448-1 1-1h16c.552 0 1 .447 1 1v18c0 .777-.894 1.28-1.514.857l-1.972-1.478-1.972 1.479c-.362.271-.872.269-1.232-.006l-1.81-1.366-1.809 1.366c-.363.273-.873.273-1.236-.001l-1.973-1.479-1.972 1.478c-.62.422-1.514-.08-1.514-.857zm16-11h-14v2h14v-2zm0 4h-14v2h14v-2zm0-8h-14v2h14v-2z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="feed-item-list">
                                <div>
                                    <h5 class="font-size-16 mb-1">Billing Info</h5>
                                    <p class="text-muted text-truncate mb-4">Your billing details are available below.
                                    </p>

                                    <div class="mb-3">
                                        <form [formGroup]="checkoutForm">
                                            <div>
                                                <div class="row">
                                                    <div class="col-lg-4">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="billing-name">Name</label>
                                                            <input
                                                                [ngClass]="{'is-invalid': checkoutForm.get('checkoutName')?.invalid && checkoutForm.get('checkoutName')?.touched}"
                                                                type="text" id="checkout-name"
                                                                formControlName="checkoutName" class="form-control"
                                                                placeholder="Full Name">
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="billing-email-address">Email
                                                                Address</label>
                                                            <input
                                                                [ngClass]="{'is-invalid': checkoutForm.get('checkoutEmail')?.invalid && checkoutForm.get('checkoutEmail')?.touched}"
                                                                type="email" id="checkout-email"
                                                                formControlName="checkoutEmail" class="form-control"
                                                                placeholder="Email">
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="mb-3">
                                                            <label class="form-label" for="billing-phone">Phone</label>
                                                            <input
                                                                [ngClass]="{'is-invalid': checkoutForm.get('checkoutPhone')?.invalid && checkoutForm.get('checkoutPhone')?.touched}"
                                                                type="tel" id="checkout-phone"
                                                                formControlName="checkoutPhone" class="form-control"
                                                                placeholder="Phone">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="mb-3">
                                                    <label class="form-label" for="billing-address">Address</label>
                                                    <textarea class="form-control" id="billing-address" rows="3"
                                                        [ngClass]="{'is-invalid': checkoutForm.get('checkoutAddress')?.invalid && checkoutForm.get('checkoutAddress')?.touched}"
                                                        formControlName="checkoutAddress"
                                                        placeholder="Your Address"></textarea>
                                                </div>

                                                <div class="row">
                                                    <div class="col-lg-4">
                                                        <div class="mb-4 mb-lg-0">
                                                            <label class="form-label">Country</label>
                                                            <select class="form-control form-select" title="Country"
                                                                [ngClass]="{'is-invalid': checkoutForm.get('checkoutCity')?.invalid && checkoutForm.get('checkoutCity')?.touched}"
                                                                id="checkout-city" formControlName="checkoutCity"
                                                                class="form-control" (change)="onCityChange($event)">
                                                                <option value="" disabled>Select a City</option>
                                                                <option *ngFor="let city of Shipping"
                                                                    [value]="city.name">{{ city.name }}</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="col-lg-4">
                                                        <div class="mb-4 mb-lg-0">
                                                            <label class="form-label" for="billing-city">City</label>
                                                            <input type="text" class="form-control" id="billing-city"
                                                                placeholder="Enter City">
                                                        </div>
                                                    </div>

                                                    <div class="col-lg-4">
                                                        <div class="mb-0">
                                                            <label class="form-label" for="zip-code">Zip / Postal
                                                                code</label>
                                                            <input type="text" class="form-control" id="zip-code"
                                                                placeholder="Enter Postal code">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="checkout-item">
                            <div class="avatar checkout-icon p-1">
                                <div class="avatar-title rounded-circle bg-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v2H3V7z"></path>
                                        <rect x="3" y="9" width="18" height="10" rx="2" ry="2"></rect>
                                        <circle cx="16" cy="14" r="1"></circle>
                                    </svg>
                                </div>
                            </div>
                            <div class="feed-item-list">
                                <div>
                                    <h5 class="font-size-16 mb-1">Payment Info</h5>
                                    <p class="text-muted text-truncate mb-4">New payment details will be provided
                                        shortly.</p>
                                </div>

                                <div>
                                    <!-- <h5 class="font-size-14 mb-3">Payment method :</h5> -->
                                    <div class="row">
                                        <div class="col-lg-3 col-sm-6">
                                            <div>
                                                <label class="card-radio-label">
                                                    <input type="radio" name="pay-method" id="pay-methodoption3"
                                                        class="card-radio-input" checked="">

                                                    <span
                                                        class="card-radio py-3 text-center text-truncate d-flex flex-column align-items-center">
                                                        <!-- SVG Icon -->
                                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <path fill-rule="evenodd" clip-rule="evenodd"
                                                                d="M18.4125 3.30938C17.4281 3 16.5281 3 14.7281 3H9.27187C7.47187 3 6.57187 3 5.5875 3.30938C5.06492 3.50054 4.59035 3.80342 4.19688 4.19688C3.80342 4.59035 3.50054 5.06492 3.30938 5.5875C3 6.56063 3 7.46625 3 9.27187V14.7253C3 16.5281 3 17.4281 3.30938 18.4125C3.50054 18.9351 3.80342 19.4097 4.19688 19.8031C4.59035 20.1966 5.06492 20.4995 5.5875 20.6906C6.56063 21 7.46625 21 9.27187 21H14.7281C16.5281 21 17.4281 21 18.4125 20.685C18.9351 20.4938 19.4097 20.191 19.8031 19.7975C20.1966 19.404 20.4995 18.9295 20.6906 18.4069C21 17.4337 21 16.5281 21 14.7225V9.27469C21 7.47187 21 6.57187 20.6906 5.5875C20.4995 5.06492 20.1966 4.59035 19.8031 4.19688C19.4097 3.80342 18.9351 3.50054 18.4125 3.30938ZM15.4505 9.69387C15.3183 9.83448 15.0849 9.83449 14.9443 9.69389L14.9499 9.69949C14.3564 9.16512 13.448 8.77418 12.503 8.77418C11.7605 8.77418 11.0208 9.04418 11.0208 9.7248C11.0208 10.3725 11.6992 10.6208 12.5264 10.9237C12.5936 10.9483 12.6619 10.9733 12.7308 10.9989C14.3339 11.5529 15.6558 12.2336 15.6558 13.8479C15.6558 15.6001 14.3283 16.8011 12.1492 16.9473L11.9523 17.9007C11.9354 17.9851 11.8896 18.061 11.823 18.1153C11.7563 18.1697 11.6727 18.1992 11.5867 18.1989L10.2226 18.1876C9.9892 18.1848 9.81763 17.9682 9.86545 17.7348L10.0736 16.7307C9.22082 16.4973 8.4727 16.0754 7.88207 15.4932C7.81063 15.4215 7.77051 15.3245 7.77051 15.2232C7.77051 15.122 7.81063 15.0249 7.88207 14.9532L8.64145 14.1939C8.67541 14.1599 8.71574 14.1329 8.76014 14.1145C8.80454 14.096 8.85213 14.0866 8.9002 14.0866C8.94826 14.0866 8.99586 14.096 9.04026 14.1145C9.08465 14.1329 9.12499 14.1599 9.15895 14.1939C9.8902 14.9279 10.8352 15.2289 11.7352 15.2289C12.7252 15.2289 13.3946 14.8182 13.3946 14.1179C13.3946 13.5027 12.8453 13.2965 11.8027 12.9052C11.692 12.8636 11.5757 12.82 11.4539 12.7736C10.1124 12.2926 8.84395 11.5923 8.84395 9.96105C8.84395 8.07668 10.3796 7.15699 12.1908 7.06418L12.3877 6.11355C12.4045 6.03013 12.4494 5.955 12.5149 5.90072C12.5804 5.84645 12.6626 5.81634 12.7477 5.81543H14.1089C14.3424 5.81543 14.5168 6.0348 14.4689 6.26824L14.2468 7.33699C14.9419 7.56868 15.5842 7.93574 16.1368 8.41699C16.2943 8.56887 16.3027 8.82199 16.1536 8.96262L15.4505 9.69387Z"
                                                                fill="#323544" />
                                                        </svg>

                                                        <!-- Cash on Delivery Text -->
                                                        <span class="mt-2">Cash on Delivery</span>
                                                    </span>

                                                </label>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </li>
                    </ol>
                </div>
            </div>
            <div class="row my-4">
                <div class="col">
                    <a href="ecommerce-products.html" class="btn btn-link text-muted">
                        <i class="mdi mdi-arrow-left me-1"></i> Continue Shopping
                    </a>
                </div>
                <div class="col">
                    <div class="text-end mt-2 mt-sm-0">
                        <!-- Change from <a> to <button> -->
                        <button (click)="onSubmit()" type="submit" class="btn btn-success"
                            style="background-color: #a10d08;" [disabled]="checkoutForm.invalid || loadingSubmit">
                            <span *ngIf="loadingSubmit" class="spinner-border spinner-border-sm me-2" role="status"
                                aria-hidden="true"></span>
                            <i class="mdi mdi-cart-outline me-1" *ngIf="!loadingSubmit"></i>
                            <span *ngIf="!loadingSubmit">Proceed</span>
                            <span *ngIf="loadingSubmit">Processing...</span>
                        </button>

                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4">
            <div class="card checkout-order-summary">
                <div class="card-body">
                    <div class="p-3 bg-light mb-3">
                        <h5 class="font-size-16 mb-0">Order Summary</h5>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-centered mb-0 table-nowrap">
                            <thead>
                                <tr>
                                    <th class="border-top-0" style="width: 110px;" scope="col">Product</th>
                                    <th class="border-top-0" scope="col">Product Desc</th>
                                    <th class="border-top-0" scope="col">Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let temp of orders">
                                    <th scope="row"><img [src]="temp.img" alt="product-img" title="product-img"
                                            class="avatar-lg rounded"></th>
                                    <td>
                                        <h5 class="font-size-16 text-truncate"><a href="#"
                                                class="text-dark">{{temp.name}}</a></h5>
                                        <p class="text-muted mb-0">
                                            <i class="bx bxs-star text-warning"></i>
                                            <i class="bx bxs-star text-warning"></i>
                                            <i class="bx bxs-star text-warning"></i>
                                            <i class="bx bxs-star text-warning"></i>
                                            <i class="bx bxs-star-half text-warning"></i>
                                        </p>
                                        <!-- <p class="text-muted mb-0 mt-1">EGP 260 x 2</p> -->
                                    </td>
                                    <td>{{ temp.priceAfterdiscount }} EGP</td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <h5 class="font-size-14 m-0">Sub Total</h5>
                                    </td>
                                    <td>
                                        {{subtotal}} EGP
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <h5 class="font-size-14 m-0">Shipping</h5>
                                    </td>
                                    <td>
                                        {{ shippingPrice }} EGP
                                    </td>
                                </tr>
                                <tr *ngIf="promoDiscount > 0">
                                    <td colspan="2">
                                        <h5 class="font-size-14 m-0">Discount</h5>
                                    </td>
                                    <td>
                                        -{{ promoDiscount }} EGP
                                    </td>
                                </tr>
                                <!-- Promo Code Row -->
                                <!-- <tr>
                                    <td colspan="3" class="border-top">
                                        
                                    </td>
                                </tr> -->
                                <tr class="bg-light">
                                    <td colspan="2">
                                        <h5 class="font-size-14 m-0">Total:</h5>
                                    </td>
                                    <td>
                                        {{ totalPrice | number:'1.2-2' }} EGP
                                    </td>
                                </tr>

                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
            <div class="card checkout-order-summary">
                <!-- <div class="card-body"> -->
                <div class="promo-code-container d-flex flex-column align-items-start gap-3">
                    <div class="promo-input-group d-flex align-items-center gap-3 w-100">
                        <input type="text" class="form-control form-control-lg promo-input" [(ngModel)]="promoCode"
                            placeholder="Enter promo code" [disabled]="promoUsed || loading" />
                        <button class="btn btn-primary promo-btn px-4 d-flex align-items-center justify-content-center"
                            (click)="applyPromoCodes()" [disabled]="!promoCode || promoUsed || loading">
                            <span *ngIf="!loading">Apply</span>
                            <div *ngIf="loading" class="spinner-border spinner-border-sm text-light" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </button>
                    </div>
                    <div *ngIf="message || promoDiscount > 0" class="promo-message mt-2">
                        <small *ngIf="promoDiscount > 0" class="text-success">
                            {{promoCode}} applied successfully
                        </small>
                        <!-- Error Message -->
                        <small *ngIf="message && promoDiscount === 0" class="text-danger">
                            {{ message }}
                        </small>
                    </div>
                </div>
                <!-- </div> -->
            </div>
        </div>
    </div>
    <!-- end row -->

</div>

<!-- <app-footer></app-footer> -->